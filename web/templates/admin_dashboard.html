{{define "admin_dashboard.html"}}
{{template "layout" .}}
{{end}}

{{define "content"}}
<section class="panel">
    <h1>Administrator Console</h1>
    <p>Manage member accounts, invites, and infrastructure from one place.</p>
    {{if .Error}}<p class="error">{{.Error}}</p>{{end}}
    {{if .Message}}<p class="info">{{.Message}}</p>{{end}}
    {{if .Users}}
    <table class="wide">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Dues</th>
                <th>Status</th>
                <th>Created</th>
                <th>Approved</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {{range .Users}}
            <tr>
                <td>#{{.ID}}</td>
                <td>{{.DisplayName}}</td>
                <td>{{.Email}}</td>
                <td>{{if .Admin}}Admin{{else}}Member{{end}}</td>
                <td>{{if .DuesCurrent}}Current{{else}}Past Due{{end}}</td>
                <td>{{if .Disabled}}Disabled{{else}}Active{{end}}</td>
                <td>{{.CreatedAt.Format "2006-01-02"}}</td>
                <td>{{if .ApprovedAt}}{{.ApprovedAt.Format "2006-01-02"}}{{else}}â€”{{end}}</td>
                <td class="stack">
                    <a class="button" href="/admin/users/{{.ID}}">View</a>
                    <form method="post" action="/admin/users/{{.ID}}/promote">
                        <button type="submit" {{if .Admin}}disabled{{end}}>Promote</button>
                    </form>
                    <form method="post" action="/admin/users/{{.ID}}/toggle-disable">
                        <button type="submit">{{if .Disabled}}Enable{{else}}Disable{{end}}</button>
                    </form>
                    <form method="post" action="/admin/users/{{.ID}}/delete" onsubmit="return confirm('Delete {{.DisplayName}}? This cannot be undone.');">
                        <button type="submit" class="danger">Delete</button>
                    </form>
                </td>
            </tr>
        {{end}}
        </tbody>
    </table>
    {{else}}
    <p>No users have registered yet.</p>
    {{end}}
</section>

<section class="panel">
    <h2>System Configuration</h2>

    <h3>Environment Variables</h3>
    {{if .EnvironmentVariables}}
    <table class="wide">
        <thead>
            <tr>
                <th>Variable</th>
                <th>Raw Value</th>
                <th>Effective Value</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody>
            {{range .EnvironmentVariables}}
            <tr>
                <td><code>{{.Name}}</code></td>
                <td>{{if eq .RawValue ""}}<em>empty</em>{{else}}<code>{{.RawValue}}</code>{{end}}</td>
                <td>{{if eq .Effective ""}}<em>empty</em>{{else}}<code>{{.Effective}}</code>{{end}}</td>
                <td>{{.Source}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p>No environment variables have been recorded.</p>
    {{end}}

    <h3>Runtime Settings</h3>
    {{if .RuntimeSettings}}
    <table class="wide">
        <thead>
            <tr>
                <th>Setting</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            {{range .RuntimeSettings}}
            <tr>
                <td>{{.Name}}</td>
                <td>{{if eq .Value ""}}<em>empty</em>{{else}}<code>{{.Value}}</code>{{end}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p>No runtime configuration details available.</p>
    {{end}}
</section>

<section class="panel">
    <h2>Test Email Delivery</h2>
    {{if not .MailerConfigured}}
    <p class="error">Email service is not configured, so test messages cannot be sent.</p>
    {{end}}
    <form method="post" action="/admin/email/test" class="stack">
        <label>Recipient
            <input type="email" name="to" placeholder="admin@example.com">
        </label>
        <label>Subject
            <input type="text" name="subject" placeholder="dystopian.earth mailer test">
        </label>
        <label>Message
            <textarea name="body" rows="4" placeholder="This is a test email from the dystopian.earth admin console."></textarea>
        </label>
        <button type="submit" {{if not .MailerConfigured}}disabled{{end}}>Send Test Email</button>
    </form>
</section>
{{end}}
